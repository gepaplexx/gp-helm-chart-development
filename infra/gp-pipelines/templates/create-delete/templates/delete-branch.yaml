apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: delete-branch
  namespace: {{ .Release.Namespace }}
spec:
  params:
    - name: repo
      type: string
    - name: branch
      type: string
    - name: user
      type: string
      default: tomeindl
  workspaces:
    - name: ssh-key
      description: Github ssh key
      mountPath: /workflow/.ssh/
    - name: mnt
      description: output
      mountPath: /mnt/out/
  steps:
    - name: git-workflow
      image: ghcr.io/gepaplexx/go-git-workflows:latest
      command: [ "git-workflows", ]
      args:
        - argo-delete
        - --url=git@github.com:tomeindl/demo-microservice.git
        - --branch=$(params.branch)
        - --name=$(params.repo)
        - --commit-user=$(params.user)
    - name: delete-ns
      image: docker.io/bitnami/kubectl
      script: |-
        #!/usr/bin/env sh
        kubectl delete project $(params.repo)-$(params.branch)