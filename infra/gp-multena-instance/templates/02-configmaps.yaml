apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "gp-multena-instance.name" . }}-proxy-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "gp-multena-instance.labels" . | nindent 4 }}
data:
  config.yaml: |-
      version: 1
      proxy:
        log_level: {{ .Values.multena.logLevel }}
        provider: {{ .Values.multena.provider}}
        upstream_url: {{ .Values.multena.upstreamUrl }}
        upstream_bypass_url: {{ .Values.multena.datasourceUrl}}
        jwks_cert_url: {{ .Values.multena.jwksCertUrl}}
        tenant_label:  {{ .Values.multena.tenantLabel}}
        admin_group:  {{ .Values.multena.adminGroup }}
        port: {{.Values.proxyService.port}}
      db:
        enabled: {{ .Values.db.enabled }}
        user: {{ .Values.db.user }}
        password_path: {{ .Values.db.passwordPath }}
        host: {{ .Values.db.host }}
        port: {{ .Values.db.port }}
        db_name: {{ .Values.db.dbName }}
        query: {{ .Values.db.query }}
      dev:
        enabled: {{ .Values.multena.dev }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "gp-multena-instance.name" . }}-proxy-groups
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "gp-multena-instance.labels" . | nindent 4 }}
data:
  groups.yaml: |-
    groups:
      - gepaplexx: [gepaplexx]
      - gepardec: [Uff, blubb]
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "gp-multena-instance.name" . }}-proxy-users
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "gp-multena-instance.labels" . | nindent 4 }}
data:
  users.yaml: |-
    users:
      - lucostus: [lucostus]
      - uff: [dev,dev2]