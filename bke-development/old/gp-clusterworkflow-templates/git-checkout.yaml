apiVersion: argoproj.io/v1alpha1
kind: ClusterWorkflowTemplate
metadata:
  name: git-checkout
spec:
  templates:
  - container:
      args:
      - |
        cd /mnt/out/ \
        && git clone {{ workflow.parameters.repo }} \
        && cd  {{ workflow.parameters.reponame }} \
        && git checkout {{=sprig.join("/", sprig.regexSplit("/", workflow.parameters.revision, -1)[2:]) }}
      command:
      - sh
      - -c
      image: alpine/git
      name: git
      volumeMounts:
      - mountPath: /mnt/out/
        name: workspace
    metadata:
      labels:
        app: argo
    name: git-checkout
